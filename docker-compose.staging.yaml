name: 'breeze-staging'

networks:
  staging:
    name: 'asn'
    external: true

services:
  kong:
    image: 'kong:latest'
    container_name: 'breeze-kong-staging'
    environment:
      - 'KONG_DATABASE=off'
      - 'KONG_DECLARATIVE_CONFIG=/usr/local/kong/declarative/kong.yml'
      - 'KONG_PROXY_ACCESS_LOG=/dev/stdout'
      - 'KONG_ADMIN_ACCESS_LOG=/dev/stdout'
      - 'KONG_PROXY_ERROR_LOG=/dev/stderr'
      - 'KONG_ADMIN_ERROR_LOG=/dev/stderr'
      - 'KONG_ADMIN_LISTEN=0.0.0.0:8001, 0.0.0.0:8444 ssl'
      - 'KONG_LOG_LEVEL=debug'
      - 'KONG_PLUGINS=bundled'
    volumes:
      - './infra/kong/staging/config:/usr/local/kong/declarative'
      - './infra/kong/staging/logs/file.log:/file.log'
    networks:
      staging:
        ipv4_address: '192.0.66.203'
    ports:
      - '8000:8000'
      - '8001:8001'
    restart: 'unless-stopped'

  auth:
    build:
      context: './apps/auth'
      dockerfile: 'staging.dockerfile'
    container_name: 'breeze-auth-staging'
    env_file: './apps/auth/staging.env'
    networks:
      staging:
        ipv4_address: '192.0.66.204'
    restart: 'unless-stopped'
